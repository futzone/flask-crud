<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O'quvchilar Boshqaruv Tizimi</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="messages">
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="header-title">
                    <svg class="header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                    </svg>
                    O'quvchilar Boshqaruv Tizimi
                </h1>
                <div class="header-stats">
                    <div class="stat-card">
                        <div class="stat-value">{{ students|length }}</div>
                        <div class="stat-label">Jami O'quvchilar</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Controls -->
            <div class="controls">
                <form action="{{ url_for('index') }}" method="GET" class="search-box">
                    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="11" cy="11" r="8" />
                        <path d="m21 21-4.35-4.35" />
                    </svg>
                    <input type="text" name="q" value="{{ search_query }}" placeholder="O'quvchilarni qidirish..."
                        class="search-input">
                </form>
                <button class="btn btn-primary" onclick="openModal('addModal')">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Yangi O'quvchi
                </button>
            </div>

            <!-- Students Table -->
            <div class="table-container">
                <table class="students-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Ism</th>
                            <th>Familiya</th>
                            <th>Tug'ilgan Sana</th>
                            <th>Bosqich</th>
                            <th>Manzil</th>
                            <th>Qo'shilgan Sana</th>
                            <th>Amallar</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if students %}
                        {% for student in students %}
                        <tr>
                            <td>{{ student.id }}</td>
                            <td>{{ student.firstname }}</td>
                            <td>{{ student.lastname }}</td>
                            <td>{{ student.birth_date }}</td>
                            <td><span class="badge">{{ student.step }}</span></td>
                            <td>{{ student.address }}</td>
                            <td>{{ student.created_date }}</td>
                            <td class="actions">
                                <button class="btn-icon-only text-blue"
                                    onclick='openEditModal({{ student.to_dict()|tojson }})'>
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </button>
                                <a href="{{ url_for('delete_student', student_id=student.id) }}"
                                    class="btn-icon-only text-red"
                                    onclick="return confirm('Rostdan ham o\'chirmoqchimisiz?')">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="8" class="text-center">Ma'lumot topilmadi</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Add Student Modal -->
    <div class="modal" id="addModal">
        <div class="modal-overlay" onclick="closeModal('addModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Yangi O'quvchi Qo'shish</h2>
                <button class="modal-close" onclick="closeModal('addModal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form action="{{ url_for('add_student') }}" method="POST" class="student-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstname" class="form-label">Ism *</label>
                        <input type="text" name="firstname" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="lastname" class="form-label">Familiya *</label>
                        <input type="text" name="lastname" class="form-input" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="birthDate" class="form-label">Tug'ilgan Sana *</label>
                        <input type="date" name="birth_date" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="step" class="form-label">Bosqich *</label>
                        <input type="text" name="step" class="form-input" placeholder="Masalan: 1-kurs" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="address" class="form-label">Manzil *</label>
                    <textarea name="address" class="form-input form-textarea" rows="3" required></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addModal')">Bekor
                        qilish</button>
                    <button type="submit" class="btn btn-primary">Saqlash</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div class="modal" id="editModal">
        <div class="modal-overlay" onclick="closeModal('editModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Tahrirlash</h2>
                <button class="modal-close" onclick="closeModal('editModal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="editForm" action="" method="POST" class="student-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit_firstname" class="form-label">Ism *</label>
                        <input type="text" id="edit_firstname" name="firstname" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="edit_lastname" class="form-label">Familiya *</label>
                        <input type="text" id="edit_lastname" name="lastname" class="form-input" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="edit_birthDate" class="form-label">Tug'ilgan Sana *</label>
                        <input type="date" id="edit_birthDate" name="birth_date" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label for="edit_step" class="form-label">Bosqich *</label>
                        <input type="text" id="edit_step" name="step" class="form-input" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="edit_address" class="form-label">Manzil *</label>
                    <textarea id="edit_address" name="address" class="form-input form-textarea" rows="3"
                        required></textarea>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editModal')">Bekor
                        qilish</button>
                    <button type="submit" class="btn btn-primary">Yangilash</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function openEditModal(student) {
            document.getElementById('edit_firstname').value = student.firstname;
            document.getElementById('edit_lastname').value = student.lastname;
            document.getElementById('edit_birthDate').value = student.birth_date;
            document.getElementById('edit_step').value = student.step;
            document.getElementById('edit_address').value = student.address;

            // Form action ni yangilash
            document.getElementById('editForm').action = '/edit/' + student.id;

            openModal('editModal');
        }
    </script>
</body>

</html>